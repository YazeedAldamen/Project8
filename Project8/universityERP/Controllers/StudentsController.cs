using Microsoft.AspNet.Identity;
using System;
using System.Collections.Generic;
using System.Data;
using System.Data.Entity;
using System.IO;
using System.Linq;
using System.Net;
using System.Net.Mail;
using System.Web;
using System.Web.Helpers;
using System.Web.Mvc;
using universityERP.Models;


namespace universityERP.Controllers
{

    public class StudentsController : Controller
    {
        private universityERPEntities db = new universityERPEntities();
        [Authorize(Roles ="Admin")]
        // GET: Students
        public ActionResult Index(string Search, string first)
        {
            //var students = db.Students.Include(c => c.Major).ToList();
            var students = db.Students.Where(x => x.isAccepted == true).ToList();
            if (first == "Fname") { students = db.Students.Where(x => x.firstName.Contains(Search)).ToList(); }
            else if (first == "Mname") { students = db.Students.Where(x => x.Major.majorName.Contains(Search)).ToList(); }
            else if (first == "Email") { students = db.Students.Where(x => x.userEmail.Contains(Search)).ToList(); }

            return View(students);

        }
[Authorize(Roles ="Admin")]

        public ActionResult Accepted(string Search, string first)
        {
            var students = db.Students.Where(x => x.isAccepted == false).ToList();
            if (first == "Fname") { students = db.Students.Where(x => x.firstName.Contains(Search)).ToList(); return View(students); }
            else if (first == "Mname") { students = db.Students.Where(x => x.Major.majorName.Contains(Search)).ToList(); return View(students); }
            else if (first == "Email") { students = db.Students.Where(x => x.userEmail.Contains(Search)).ToList(); return View(students); }

            var student = db.Students.Where(x => x.isAccepted == false).ToList();

            return View(student);
        }

            [Authorize(Roles = "Admin")]
        // GET: Students/Details/5
        public ActionResult Details(int? id)
        {
            if (id == null)
            {
                return new HttpStatusCodeResult(HttpStatusCode.BadRequest);
            }
            Student student = db.Students.Find(id);
            if (student == null)
            {
                return HttpNotFound();
            }
            return View(student);
        }

        [Authorize(Roles = "Student")]
        public ActionResult ProfileDetails()
        {

            var user = User.Identity.GetUserName().ToString();

            int id = db.Students.FirstOrDefault(d => d.userEmail == user).studentId;
            Student student = db.Students.Find(id);
            if (student == null)
            {
                return HttpNotFound();
            }
            return View(student);
        }
        // GET: Students/Create
        [Authorize(Roles = "Admin")]
        public ActionResult Create()
        {
            ViewBag.majorId = new SelectList(db.Majors, "majorId", "majorName");
            return View();
        }

        // POST: Students/Create
        // To protect from overposting attacks, enable the specific properties you want to bind to, for 
        // more details see https://go.microsoft.com/fwlink/?LinkId=317598.
        [Authorize(Roles = "Admin")]
        [HttpPost]
        [ValidateAntiForgeryToken]
        public ActionResult Create([Bind(Include = "studentId,firstName,lastName,image,majorId,isAccepted,tawjihiAvg,userEmail")] Student student)
        {
            if (ModelState.IsValid)
            {
                db.Students.Add(student);
                db.SaveChanges();
                return RedirectToAction("Index");
            }

            ViewBag.majorId = new SelectList(db.Majors, "majorId", "majorName", student.majorId);
            return View(student);
        }


        [Authorize(Roles = "Admin")]
        // GET: Students/Edit/5
        public ActionResult Edit(int? id)
        {
            if (id == null)
            {
                return new HttpStatusCodeResult(HttpStatusCode.BadRequest);
            }
            Student student = db.Students.Find(id);
            if (student == null)
            {
                return HttpNotFound();
            }
            ViewBag.majorId = new SelectList(db.Majors, "majorId", "majorName", student.majorId);
            return View(student);
        }

        // POST: Students/Edit/5
        // To protect from overposting attacks, enable the specific properties you want to bind to, for 
        // more details see https://go.microsoft.com/fwlink/?LinkId=317598.
        [Authorize(Roles = "Admin")]
        [HttpPost]
        [ValidateAntiForgeryToken]
        public ActionResult Edit(int? id, [Bind(Include = "studentId,firstName,lastName,image,majorId,isAccepted,tawjihiAvg,userEmail")] Student student, HttpPostedFileBase image)
        {

            if (ModelState.IsValid)
            {
                var existingModel = db.Students.AsNoTracking().FirstOrDefault(x => x.studentId == id);


                if (image != null)
                {
                    string _FileName = Path.GetFileName(image.FileName);
                    string _path = Path.Combine(Server.MapPath("~/images"), _FileName);
                    image.SaveAs(_path);
                    student.image = _FileName;

                }
                else
                {
                    student.image = existingModel.image;
                }


                db.Entry(student).State = EntityState.Modified;
                db.SaveChanges();


                if (student.isAccepted == true)
                {
                    string Email = student.userEmail;
                    MailMessage mail = new MailMessage();
                    mail.To.Add(Email);
                    mail.From = new MailAddress("hopeorganization23@gmail.com");
                    mail.Subject = "UniCat Admission";
                    mail.Body = $"<!DOCTYPE html PUBLIC \"-//W3C//DTD XHTML 1.0 Transitional //EN\" \"http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd\">\r\n<html\r\n  xmlns=\"http://www.w3.org/1999/xhtml\"\r\n  xmlns:v=\"urn:schemas-microsoft-com:vml\"\r\n  xmlns:o=\"urn:schemas-microsoft-com:office:office\"\r\n>\r\n  <head>\r\n    <!--[if gte mso 9]>\r\n      <xml>\r\n        <o:OfficeDocumentSettings>\r\n          <o:AllowPNG />\r\n          <o:PixelsPerInch>96</o:PixelsPerInch>\r\n        </o:OfficeDocumentSettings>\r\n      </xml>\r\n    <![endif]-->\r\n    <meta http-equiv=\"Content-Type\" content=\"text/html; charset=UTF-8\" />\r\n    <meta name=\"viewport\" content=\"width=device-width, initial-scale=1.0\" />\r\n    <meta name=\"x-apple-disable-message-reformatting\" />\r\n    <!--[if !mso]><!-->\r\n    <meta http-equiv=\"X-UA-Compatible\" content=\"IE=edge\" />\r\n    <!--<![endif]-->\r\n    <title></title>\r\n\r\n    <style type=\"text/css\">\r\n      @media only screen and (min-width: 620px) {{\r\n        .u-row {{\r\n          width: 600px !important;\r\n        }}\r\n        .u-row .u-col {{\r\n          vertical-align: top;\r\n        }}\r\n\r\n        .u-row .u-col-100 {{\r\n          width: 600px !important;\r\n        }}\r\n      }}\r\n\r\n      @media (max-width: 620px) {{\r\n        .u-row-container {{\r\n          max-width: 100% !important;\r\n          padding-left: 0px !important;\r\n          padding-right: 0px !important;\r\n        }}\r\n        .u-row .u-col {{\r\n          min-width: 320px !important;\r\n          max-width: 100% !important;\r\n          display: block !important;\r\n        }}\r\n        .u-row {{\r\n          width: 100% !important;\r\n        }}\r\n        .u-col {{\r\n          width: 100% !important;\r\n        }}\r\n        .u-col > div {{\r\n          margin: 0 auto;\r\n        }}\r\n      }}\r\n      body {{\r\n        margin: 0;\r\n        padding: 0;\r\n      }}\r\n\r\n      table,\r\n      tr,\r\n      td {{\r\n        vertical-align: top;\r\n        border-collapse: collapse;\r\n      }}\r\n\r\n      p {{\r\n        margin: 0;\r\n      }}\r\n\r\n      .ie-container table,\r\n      .mso-container table {{\r\n        table-layout: fixed;\r\n      }}\r\n\r\n      * {{\r\n        line-height: inherit;\r\n      }}\r\n\r\n      a[x-apple-data-detectors=\"true\"] {{\r\n        color: inherit !important;\r\n        text-decoration: none !important;\r\n      }}\r\n\r\n      table,\r\n      td {{\r\n        color: #000000;\r\n      }}\r\n      @media (max-width: 480px) {{\r\n        #u_content_text_1 .v-container-padding-padding {{\r\n          padding: 40px 10px 10px !important;\r\n        }}\r\n        #u_content_text_2 .v-container-padding-padding {{\r\n          padding: 8px 10px 40px !important;\r\n        }}\r\n      }}\r\n    </style>\r\n\r\n    <!--[if !mso]><!-->\r\n    <link\r\n      href=\"https://fonts.googleapis.com/css?family=Montserrat:400,700&display=swap\"\r\n      rel=\"stylesheet\"\r\n      type=\"text/css\"\r\n    />\r\n    <link\r\n      href=\"https://fonts.googleapis.com/css?family=Pacifico&display=swap\"\r\n      rel=\"stylesheet\"\r\n      type=\"text/css\"\r\n    />\r\n    <!--<![endif]-->\r\n  </head>\r\n\r\n  <body\r\n    class=\"clean-body u_body\"\r\n    style=\"\r\n      margin: 0;\r\n      padding: 0;\r\n      -webkit-text-size-adjust: 100%;\r\n      background-color: #ffffff;\r\n      color: #000000;\r\n    \"\r\n  >\r\n    <!--[if IE]><div class=\"ie-container\"><![endif]-->\r\n    <!--[if mso]><div class=\"mso-container\"><![endif]-->\r\n    <table\r\n      style=\"\r\n        border-collapse: collapse;\r\n        table-layout: fixed;\r\n        border-spacing: 0;\r\n        mso-table-lspace: 0pt;\r\n        mso-table-rspace: 0pt;\r\n        vertical-align: top;\r\n        min-width: 320px;\r\n        margin: 0 auto;\r\n        background-color: #ffffff;\r\n        width: 100%;\r\n      \"\r\n      cellpadding=\"0\"\r\n      cellspacing=\"0\"\r\n    >\r\n      <tbody>\r\n        <tr style=\"vertical-align: top\">\r\n          <td\r\n            style=\"\r\n              word-break: break-word;\r\n              border-collapse: collapse !important;\r\n              vertical-align: top;\r\n            \"\r\n          >\r\n            <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td align=\"center\" style=\"background-color: #ffffff;\"><![endif]-->\r\n\r\n            <div\r\n              class=\"u-row-container\"\r\n              style=\"padding: 0px; background-color: transparent\"\r\n            >\r\n              <div\r\n                class=\"u-row\"\r\n                style=\"\r\n                  margin: 0 auto;\r\n                  min-width: 320px;\r\n                  max-width: 600px;\r\n                  overflow-wrap: break-word;\r\n                  word-wrap: break-word;\r\n                  word-break: break-word;\r\n                  background-color: #2f3031;\r\n                \"\r\n              >\r\n                <div\r\n                  style=\"\r\n                    border-collapse: collapse;\r\n                    display: table;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    background-color: transparent;\r\n                  \"\r\n                >\r\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: transparent;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: #2f3031;\"><![endif]-->\r\n\r\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;\" valign=\"top\"><![endif]-->\r\n                  <div\r\n                    class=\"u-col u-col-100\"\r\n                    style=\"\r\n                      max-width: 320px;\r\n                      min-width: 600px;\r\n                      display: table-cell;\r\n                      vertical-align: top;\r\n                    \"\r\n                  >\r\n                    <div style=\"height: 100%; width: 100% !important\">\r\n                      <!--[if (!mso)&(!IE)]><!--><div\r\n                        style=\"\r\n                          box-sizing: border-box;\r\n                          height: 100%;\r\n                          padding: 0px;\r\n                          border-top: 0px solid transparent;\r\n                          border-left: 0px solid transparent;\r\n                          border-right: 0px solid transparent;\r\n                          border-bottom: 0px solid transparent;\r\n                        \"\r\n                      ><!--<![endif]-->\r\n                        <!--[if (!mso)&(!IE)]><!-->\r\n                      </div>\r\n                      <!--<![endif]-->\r\n                    </div>\r\n                  </div>\r\n                  <!--[if (mso)|(IE)]></td><![endif]-->\r\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              class=\"u-row-container\"\r\n              style=\"padding: 0px; background-color: transparent\"\r\n            >\r\n              <div\r\n                class=\"u-row\"\r\n                style=\"\r\n                  margin: 0 auto;\r\n                  min-width: 320px;\r\n                  max-width: 600px;\r\n                  overflow-wrap: break-word;\r\n                  word-wrap: break-word;\r\n                  word-break: break-word;\r\n                  background-color: transparent;\r\n                \"\r\n              >\r\n                <div\r\n                  style=\"\r\n                    border-collapse: collapse;\r\n                    display: table;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    background-color: transparent;\r\n                  \"\r\n                >\r\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: transparent;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: transparent;\"><![endif]-->\r\n\r\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\" valign=\"top\"><![endif]-->\r\n                  <div\r\n                    class=\"u-col u-col-100\"\r\n                    style=\"\r\n                      max-width: 320px;\r\n                      min-width: 600px;\r\n                      display: table-cell;\r\n                      vertical-align: top;\r\n                    \"\r\n                  >\r\n                    <div\r\n                      style=\"\r\n                        height: 100%;\r\n                        width: 100% !important;\r\n                        border-radius: 0px;\r\n                        -webkit-border-radius: 0px;\r\n                        -moz-border-radius: 0px;\r\n                      \"\r\n                    >\r\n                      <!--[if (!mso)&(!IE)]><!--><div\r\n                        style=\"\r\n                          box-sizing: border-box;\r\n                          height: 100%;\r\n                          padding: 0px;\r\n                          border-top: 0px solid transparent;\r\n                          border-left: 0px solid transparent;\r\n                          border-right: 0px solid transparent;\r\n                          border-bottom: 0px solid transparent;\r\n                          border-radius: 0px;\r\n                          -webkit-border-radius: 0px;\r\n                          -moz-border-radius: 0px;\r\n                        \"\r\n                      ><!--<![endif]-->\r\n                        <!--[if (!mso)&(!IE)]><!-->\r\n                      </div>\r\n                      <!--<![endif]-->\r\n                    </div>\r\n                  </div>\r\n                  <!--[if (mso)|(IE)]></td><![endif]-->\r\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              class=\"u-row-container\"\r\n              style=\"padding: 0px; background-color: transparent\"\r\n            >\r\n              <div\r\n                class=\"u-row\"\r\n                style=\"\r\n                  margin: 0 auto;\r\n                  min-width: 320px;\r\n                  max-width: 600px;\r\n                  overflow-wrap: break-word;\r\n                  word-wrap: break-word;\r\n                  word-break: break-word;\r\n                  background-color: #2f3031;\r\n                \"\r\n              >\r\n                <div\r\n                  style=\"\r\n                    border-collapse: collapse;\r\n                    display: table;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    background-image: url('%20');\r\n                    background-repeat: no-repeat;\r\n                    background-position: center top;\r\n                    background-color: transparent;\r\n                  \"\r\n                >\r\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: transparent;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-image: url('%20');background-repeat: no-repeat;background-position: center top;background-color: #2f3031;\"><![endif]-->\r\n\r\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\" valign=\"top\"><![endif]-->\r\n                  <div\r\n                    class=\"u-col u-col-100\"\r\n                    style=\"\r\n                      max-width: 320px;\r\n                      min-width: 600px;\r\n                      display: table-cell;\r\n                      vertical-align: top;\r\n                    \"\r\n                  >\r\n                    <div\r\n                      style=\"\r\n                        height: 100%;\r\n                        width: 100% !important;\r\n                        border-radius: 0px;\r\n                        -webkit-border-radius: 0px;\r\n                        -moz-border-radius: 0px;\r\n                      \"\r\n                    >\r\n                      <!--[if (!mso)&(!IE)]><!--><div\r\n                        style=\"\r\n                          box-sizing: border-box;\r\n                          height: 100%;\r\n                          padding: 0px;\r\n                          border-top: 0px solid transparent;\r\n                          border-left: 0px solid transparent;\r\n                          border-right: 0px solid transparent;\r\n                          border-bottom: 0px solid transparent;\r\n                          border-radius: 0px;\r\n                          -webkit-border-radius: 0px;\r\n                          -moz-border-radius: 0px;\r\n                        \"\r\n                      ><!--<![endif]-->\r\n                        <!--[if (!mso)&(!IE)]><!-->\r\n                      </div>\r\n                      <!--<![endif]-->\r\n                    </div>\r\n                  </div>\r\n                  <!--[if (mso)|(IE)]></td><![endif]-->\r\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              class=\"u-row-container\"\r\n              style=\"padding: 0px; background-color: transparent\"\r\n            >\r\n              <div\r\n                class=\"u-row\"\r\n                style=\"\r\n                  margin: 0 auto;\r\n                  min-width: 320px;\r\n                  max-width: 600px;\r\n                  overflow-wrap: break-word;\r\n                  word-wrap: break-word;\r\n                  word-break: break-word;\r\n                  background-color: #fbfbfb;\r\n                \"\r\n              >\r\n                <div\r\n                  style=\"\r\n                    border-collapse: collapse;\r\n                    display: table;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    background-color: transparent;\r\n                  \"\r\n                >\r\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: transparent;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: #fbfbfb;\"><![endif]-->\r\n\r\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\" valign=\"top\"><![endif]-->\r\n                  <div\r\n                    class=\"u-col u-col-100\"\r\n                    style=\"\r\n                      max-width: 320px;\r\n                      min-width: 600px;\r\n                      display: table-cell;\r\n                      vertical-align: top;\r\n                    \"\r\n                  >\r\n                    <div\r\n                      style=\"\r\n                        height: 100%;\r\n                        width: 100% !important;\r\n                        border-radius: 0px;\r\n                        -webkit-border-radius: 0px;\r\n                        -moz-border-radius: 0px;\r\n                      \"\r\n                    >\r\n                      <!--[if (!mso)&(!IE)]><!--><div\r\n                        style=\"\r\n                          box-sizing: border-box;\r\n                          height: 100%;\r\n                          padding: 0px;\r\n                          border-top: 0px solid transparent;\r\n                          border-left: 0px solid transparent;\r\n                          border-right: 0px solid transparent;\r\n                          border-bottom: 0px solid transparent;\r\n                          border-radius: 0px;\r\n                          -webkit-border-radius: 0px;\r\n                          -moz-border-radius: 0px;\r\n                        \"\r\n                      ><!--<![endif]-->\r\n                        <table\r\n                          id=\"u_content_text_1\"\r\n                          style=\"font-family: arial, helvetica, sans-serif\"\r\n                          role=\"presentation\"\r\n                          cellpadding=\"0\"\r\n                          cellspacing=\"0\"\r\n                          width=\"100%\"\r\n                          border=\"0\"\r\n                        >\r\n                          <tbody>\r\n                            <tr>\r\n                              <td\r\n                                class=\"v-container-padding-padding\"\r\n                                style=\"\r\n                                  overflow-wrap: break-word;\r\n                                  word-break: break-word;\r\n                                  padding: 50px 35px 10px 40px;\r\n                                  font-family: arial, helvetica, sans-serif;\r\n                                \"\r\n                                align=\"left\"\r\n                              >\r\n                                <div\r\n                                  style=\"\r\n                                    color: #000000;\r\n                                    line-height: 180%;\r\n                                    text-align: left;\r\n                                    word-wrap: break-word;\r\n                                  \"\r\n                                >\r\n                                  <p style=\"line-height: 180%\">\r\n                                    <span\r\n                                      style=\"\r\n                                        font-size: 12px;\r\n                                        line-height: 21.6px;\r\n                                      \"\r\n                                      >Dear {student.firstName},</span\r\n                                    >\r\n                                  </p>\r\n                                  <p style=\"line-height: 180%\">\r\n                                    <span\r\n                                      style=\"\r\n                                        font-size: 12px;\r\n                                        line-height: 21.6px;\r\n                                      \"\r\n                                      >We are pleased to inform you that you\r\n                                      have been accepted into [University Name]\r\n                                      for the upcoming academic year.\r\n                                      Congratulations on this outstanding\r\n                                      achievement! Your application stood out\r\n                                      among many others due to your exceptional\r\n                                      academic record, your strong\r\n                                      extracurricular activities, and your\r\n                                      commitment to excellence. Our admissions\r\n                                      committee was impressed by your\r\n                                      intellectual curiosity, your dedication to\r\n                                      your chosen field of study, and your\r\n                                      potential to make a significant impact in\r\n                                      your future career. As a student at\r\n                                      [University Name], you will have the\r\n                                      opportunity to learn from some of the most\r\n                                      distinguished faculty in the country,\r\n                                      engage in cutting-edge research, and\r\n                                      collaborate with a diverse community of\r\n                                      scholars from around the world. We are\r\n                                      confident that you will thrive in our\r\n                                      challenging academic environment and make\r\n                                      the most of the many resources and\r\n                                      opportunities that our university has to\r\n                                      offer. We encourage you to review the\r\n                                      information included in your acceptance\r\n                                      package carefully, as it contains\r\n                                      important information about your next\r\n                                      steps. Please submit your acceptance of\r\n                                      our offer as soon as possible to secure\r\n                                      your place in our incoming class. If you\r\n                                      have any questions or concerns, please do\r\n                                      not hesitate to contact us at [contact\r\n                                      information]. Once again, congratulations\r\n                                      on your acceptance to [University Name].\r\n                                      We look forward to welcoming you to our\r\n                                      community and watching you achieve your\r\n                                      academic and professional goals.</span\r\n                                    >\r\n                                  </p>\r\n                                  <p style=\"line-height: 180%\">\r\n                                    <span\r\n                                      style=\"\r\n                                        font-size: 12px;\r\n                                        line-height: 21.6px;\r\n                                      \"\r\n                                      >Sincerely,</span\r\n                                    >\r\n                                  </p>\r\n                                  <p style=\"line-height: 180%\">\r\n                                    <span\r\n                                      style=\"\r\n                                        font-size: 12px;\r\n                                        line-height: 21.6px;\r\n                                      \"\r\n                                      >UniCat Admissions Committee</span\r\n                                    >\r\n                                  </p>\r\n                                </div>\r\n                              </td>\r\n                            </tr>\r\n                          </tbody>\r\n                        </table>\r\n\r\n                        <table\r\n                          id=\"u_content_text_2\"\r\n                          style=\"font-family: arial, helvetica, sans-serif\"\r\n                          role=\"presentation\"\r\n                          cellpadding=\"0\"\r\n                          cellspacing=\"0\"\r\n                          width=\"100%\"\r\n                          border=\"0\"\r\n                        >\r\n                          <tbody>\r\n                            <tr>\r\n                              <td\r\n                                class=\"v-container-padding-padding\"\r\n                                style=\"\r\n                                  overflow-wrap: break-word;\r\n                                  word-break: break-word;\r\n                                  padding: 8px 35px 40px 40px;\r\n                                  font-family: arial, helvetica, sans-serif;\r\n                                \"\r\n                                align=\"left\"\r\n                              >\r\n                                <div\r\n                                  style=\"\r\n                                    color: #000000;\r\n                                    line-height: 180%;\r\n                                    text-align: left;\r\n                                    word-wrap: break-word;\r\n                                  \"\r\n                                >\r\n                                  <p style=\"line-height: 180%; font-size: 14px\">\r\n                                    <span\r\n                                      style=\"\r\n                                        font-family: Montserrat, sans-serif;\r\n                                        font-size: 16px;\r\n                                        line-height: 28.8px;\r\n                                      \"\r\n                                      >If you have any questions, please feel\r\n                                      free to contact me directly.</span\r\n                                    >\r\n                                  </p>\r\n                                  <p style=\"font-size: 14px; line-height: 180%\">\r\n                                    <span\r\n                                      style=\"\r\n                                        font-size: 16px;\r\n                                        line-height: 28.8px;\r\n                                        font-family: Montserrat, sans-serif;\r\n                                      \"\r\n                                      >Looking forward to your reply,</span\r\n                                    >\r\n                                  </p>\r\n                                  <p style=\"line-height: 180%; font-size: 14px\">\r\n                                    <br /><span\r\n                                      style=\"\r\n                                        font-size: 16px;\r\n                                        line-height: 28.8px;\r\n                                        font-family: Montserrat, sans-serif;\r\n                                      \"\r\n                                      >Yours sincerely,</span\r\n                                    ><br /><span\r\n                                      style=\"\r\n                                        font-size: 18px;\r\n                                        line-height: 32.4px;\r\n                                      \"\r\n                                      ><span\r\n                                        style=\"\r\n                                          line-height: 32.4px;\r\n                                          font-family: Pacifico, cursive;\r\n                                          font-size: 18px;\r\n                                        \"\r\n                                        >UniCat</span\r\n                                      ></span\r\n                                    >\r\n                                  </p>\r\n                                </div>\r\n                              </td>\r\n                            </tr>\r\n                          </tbody>\r\n                        </table>\r\n\r\n                        <table\r\n                          style=\"font-family: arial, helvetica, sans-serif\"\r\n                          role=\"presentation\"\r\n                          cellpadding=\"0\"\r\n                          cellspacing=\"0\"\r\n                          width=\"100%\"\r\n                          border=\"0\"\r\n                        >\r\n                          <tbody>\r\n                            <tr>\r\n                              <td\r\n                                class=\"v-container-padding-padding\"\r\n                                style=\"\r\n                                  overflow-wrap: break-word;\r\n                                  word-break: break-word;\r\n                                  padding: 0px;\r\n                                  font-family: arial, helvetica, sans-serif;\r\n                                \"\r\n                                align=\"left\"\r\n                              >\r\n                                <table\r\n                                  width=\"100%\"\r\n                                  cellpadding=\"0\"\r\n                                  cellspacing=\"0\"\r\n                                  border=\"0\"\r\n                                >\r\n                                  <tr>\r\n                                    <td\r\n                                      style=\"\r\n                                        padding-right: 0px;\r\n                                        padding-left: 0px;\r\n                                      \"\r\n                                      align=\"center\"\r\n                                    >\r\n                                      <img\r\n                                        align=\"center\"\r\n                                        border=\"0\"\r\n                                        src=\"https://cdn.templates.unlayer.com/assets/1638520170619-12.png\" \r\n                                        alt=\"border\"\r\n                                        title=\"border\"\r\n                                        style=\"\r\n                                          outline: none;\r\n                                          text-decoration: none;\r\n                                          -ms-interpolation-mode: bicubic;\r\n                                          clear: both;\r\n                                          display: inline-block !important;\r\n                                          border: none;\r\n                                          height: auto;\r\n                                          float: none;\r\n                                          width: 100%;\r\n                                          max-width: 600px;\r\n                                        \"\r\n                                        width=\"600\"\r\n                                      />\r\n                                    </td>\r\n                                  </tr>\r\n                                </table>\r\n                              </td>\r\n                            </tr>\r\n                          </tbody>\r\n                        </table>\r\n\r\n                        <!--[if (!mso)&(!IE)]><!-->\r\n                      </div>\r\n                      <!--<![endif]-->\r\n                    </div>\r\n                  </div>\r\n                  <!--[if (mso)|(IE)]></td><![endif]-->\r\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              class=\"u-row-container\"\r\n              style=\"padding: 0px; background-color: transparent\"\r\n            >\r\n              <div\r\n                class=\"u-row\"\r\n                style=\"\r\n                  margin: 0 auto;\r\n                  min-width: 320px;\r\n                  max-width: 600px;\r\n                  overflow-wrap: break-word;\r\n                  word-wrap: break-word;\r\n                  word-break: break-word;\r\n                  background-color: #2f2f2f;\r\n                \"\r\n              >\r\n                <div\r\n                  style=\"\r\n                    border-collapse: collapse;\r\n                    display: table;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    background-image: url('%20');\r\n                    background-repeat: no-repeat;\r\n                    background-position: center top;\r\n                    background-color: transparent;\r\n                  \"\r\n                >\r\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: transparent;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-image: url('%20');background-repeat: no-repeat;background-position: center top;background-color: #2f2f2f;\"><![endif]-->\r\n\r\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\" valign=\"top\"><![endif]-->\r\n                  <div\r\n                    class=\"u-col u-col-100\"\r\n                    style=\"\r\n                      max-width: 320px;\r\n                      min-width: 600px;\r\n                      display: table-cell;\r\n                      vertical-align: top;\r\n                    \"\r\n                  >\r\n                    <div\r\n                      style=\"\r\n                        height: 100%;\r\n                        width: 100% !important;\r\n                        border-radius: 0px;\r\n                        -webkit-border-radius: 0px;\r\n                        -moz-border-radius: 0px;\r\n                      \"\r\n                    >\r\n                      <!--[if (!mso)&(!IE)]><!--><div\r\n                        style=\"\r\n                          box-sizing: border-box;\r\n                          height: 100%;\r\n                          padding: 0px;\r\n                          border-top: 0px solid transparent;\r\n                          border-left: 0px solid transparent;\r\n                          border-right: 0px solid transparent;\r\n                          border-bottom: 0px solid transparent;\r\n                          border-radius: 0px;\r\n                          -webkit-border-radius: 0px;\r\n                          -moz-border-radius: 0px;\r\n                        \"\r\n                      ><!--<![endif]-->\r\n                        <!--[if (!mso)&(!IE)]><!-->\r\n                      </div>\r\n                      <!--<![endif]-->\r\n                    </div>\r\n                  </div>\r\n                  <!--[if (mso)|(IE)]></td><![endif]-->\r\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <div\r\n              class=\"u-row-container\"\r\n              style=\"padding: 0px; background-color: transparent\"\r\n            >\r\n              <div\r\n                class=\"u-row\"\r\n                style=\"\r\n                  margin: 0 auto;\r\n                  min-width: 320px;\r\n                  max-width: 600px;\r\n                  overflow-wrap: break-word;\r\n                  word-wrap: break-word;\r\n                  word-break: break-word;\r\n                  background-color: transparent;\r\n                \"\r\n              >\r\n                <div\r\n                  style=\"\r\n                    border-collapse: collapse;\r\n                    display: table;\r\n                    width: 100%;\r\n                    height: 100%;\r\n                    background-color: transparent;\r\n                  \"\r\n                >\r\n                  <!--[if (mso)|(IE)]><table width=\"100%\" cellpadding=\"0\" cellspacing=\"0\" border=\"0\"><tr><td style=\"padding: 0px;background-color: transparent;\" align=\"center\"><table cellpadding=\"0\" cellspacing=\"0\" border=\"0\" style=\"width:600px;\"><tr style=\"background-color: transparent;\"><![endif]-->\r\n\r\n                  <!--[if (mso)|(IE)]><td align=\"center\" width=\"600\" style=\"width: 600px;padding: 0px;border-top: 0px solid transparent;border-left: 0px solid transparent;border-right: 0px solid transparent;border-bottom: 0px solid transparent;border-radius: 0px;-webkit-border-radius: 0px; -moz-border-radius: 0px;\" valign=\"top\"><![endif]-->\r\n                  <div\r\n                    class=\"u-col u-col-100\"\r\n                    style=\"\r\n                      max-width: 320px;\r\n                      min-width: 600px;\r\n                      display: table-cell;\r\n                      vertical-align: top;\r\n                    \"\r\n                  >\r\n                    <div\r\n                      style=\"\r\n                        height: 100%;\r\n                        width: 100% !important;\r\n                        border-radius: 0px;\r\n                        -webkit-border-radius: 0px;\r\n                        -moz-border-radius: 0px;\r\n                      \"\r\n                    >\r\n                      <!--[if (!mso)&(!IE)]><!--><div\r\n                        style=\"\r\n                          box-sizing: border-box;\r\n                          height: 100%;\r\n                          padding: 0px;\r\n                          border-top: 0px solid transparent;\r\n                          border-left: 0px solid transparent;\r\n                          border-right: 0px solid transparent;\r\n                          border-bottom: 0px solid transparent;\r\n                          border-radius: 0px;\r\n                          -webkit-border-radius: 0px;\r\n                          -moz-border-radius: 0px;\r\n                        \"\r\n                      ><!--<![endif]-->\r\n                        <table\r\n                          style=\"font-family: arial, helvetica, sans-serif\"\r\n                          role=\"presentation\"\r\n                          cellpadding=\"0\"\r\n                          cellspacing=\"0\"\r\n                          width=\"100%\"\r\n                          border=\"0\"\r\n                        >\r\n                          <tbody>\r\n                            <tr>\r\n                              <td\r\n                                class=\"v-container-padding-padding\"\r\n                                style=\"\r\n                                  overflow-wrap: break-word;\r\n                                  word-break: break-word;\r\n                                  padding: 20px 10px;\r\n                                  font-family: arial, helvetica, sans-serif;\r\n                                \"\r\n                                align=\"left\"\r\n                              >\r\n                                <div\r\n                                  style=\"\r\n                                    color: #6f7a7a;\r\n                                    line-height: 140%;\r\n                                    text-align: center;\r\n                                    word-wrap: break-word;\r\n                                  \"\r\n                                ></div>\r\n                              </td>\r\n                            </tr>\r\n                          </tbody>\r\n                        </table>\r\n\r\n                        <!--[if (!mso)&(!IE)]><!-->\r\n                      </div>\r\n                      <!--<![endif]-->\r\n                    </div>\r\n                  </div>\r\n                  <!--[if (mso)|(IE)]></td><![endif]-->\r\n                  <!--[if (mso)|(IE)]></tr></table></td></tr></table><![endif]-->\r\n                </div>\r\n              </div>\r\n            </div>\r\n\r\n            <!--[if (mso)|(IE)]></td></tr></table><![endif]-->\r\n          </td>\r\n        </tr>\r\n      </tbody>\r\n    </table>\r\n    <!--[if mso]></div><![endif]-->\r\n    <!--[if IE]></div><![endif]-->\r\n  </body>\r\n</html>\r\n";

                    mail.IsBodyHtml = true;
                    SmtpClient smtp = new SmtpClient();
                    smtp.Port = 587; // 25 465
                    smtp.EnableSsl = true;
                    smtp.UseDefaultCredentials = false;
                    smtp.Host = "smtp.gmail.com";
                    smtp.Credentials = new System.Net.NetworkCredential("hopeorganization23@gmail.com", "mbuyaativxrfntjx\r\n");
                    smtp.Send(mail);
                }

                return RedirectToAction("Index");

            }

           

            ViewBag.majorId = new SelectList(db.Majors, "majorId", "majorName", student.majorId);
            return View(student);

        }

        // GET: Students/Delete/5
        [Authorize(Roles = "Admin")]
        public ActionResult Delete(int? id)
        {
            if (id == null)
            {
                return new HttpStatusCodeResult(HttpStatusCode.BadRequest);
            }
            Student student = db.Students.Find(id);
            if (student == null)
            {
                return HttpNotFound();
            }
            return View(student);
        }

        [Authorize(Roles = "Admin")]

        // POST: Students/Delete/5
        [HttpPost, ActionName("Delete")]
        [ValidateAntiForgeryToken]
        public ActionResult DeleteConfirmed(int id)
        {
            Student student = db.Students.Find(id);
            db.Students.Remove(student);
            db.SaveChanges();
            return RedirectToAction("Index");
        }

        protected override void Dispose(bool disposing)
        {
            if (disposing)
            {
                db.Dispose();
            }
            base.Dispose(disposing);
        }
    }
}
